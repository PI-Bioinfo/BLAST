// Estimate CPU/memory/container
process {
    cpus   = { check_max( 1    * task.attempt, 'cpus'   ) }
    memory = { check_max( 6.GB * task.attempt, 'memory' ) }
    time   = { check_max( 1.h  * task.attempt, 'time'   ) }
    // memory errors which should be retried. otherwise error out
    errorStrategy = { task.exitStatus in ((130..145) + 104) ? 'retry' : 'finish' }
    maxRetries    = 1
    maxErrors     = '-1'
    withName: SUBSETFILE {
        cpus             = 4
        memory           = 1.GB
        //container      = "chaudb/seqtk:latest"
    }

     withName: downloadNCBIDb {
        cpus             = 4
        memory           = 1.GB
        time             = { check_max( 4.h   * task.attempt, 'time' ) }
    }
    
    withName: makeBlastDb {
        cpus             = 4
        memory           = 1.GB
        //container      =  "ncbi/blast:latest"'
    }
    withName: BLASTSEARCH {
        cpus             = 8
        memory           = 1.GB
        time             = { check_max( 4.h   * task.attempt, 'time' ) }
        //container      = 'ncbi/blast:latest'
    }
}

docker {
    enabled              = true
}
